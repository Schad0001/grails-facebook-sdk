<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
                      "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
    <head>
        <title>Facebook SDK Plugin 0.6.4</title>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <link rel="stylesheet" href="../css/main.css" type="text/css" media="screen, print" title="Style" charset="utf-8" />
        <link rel="stylesheet" href="../css/pdf.css" type="text/css" media="print" title="PDF" charset="utf-8" />
    <script type="text/javascript">
function addJsClass(el) {
    var classes = document.body.className.split(" ");
    classes.push("js");
    document.body.className = classes.join(" ");
}
    </script>
    </head>

    <body class="body" onload="addJsClass();">
        <div id="navigation">
            <ul>
                <li>
                    <div id="nav-summary" onmouseover="toggleNavSummary(false)" onmouseout="toggleNavSummary(true)">
                        <a href="../guide/index.html" class="button">Table of contents</a>
                        <div id="nav-summary-childs" style="display:none;">
                            
                            <div class="toc-item" style="margin-left:0"><a href="#introduction"><strong>1</strong><span>Introduction</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0"><a href="#configuration"><strong>2</strong><span>Configuration</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0"><a href="#facebookContext"><strong>3</strong><span>Facebook Context</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0"><a href="#facebookGraphClient"><strong>4</strong><span>Facebook Graph Client</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0"><a href="#facebookJSTagLib"><strong>5</strong><span>Facebook JS Tag Lib</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0"><a href="#facebookSocialPlugins"><strong>6</strong><span>Facebook Social Plugins</span></a></div>
                            
                        </div>
                    </div>
                </li>
                <li class="separator selected">
                    <a id="ref-button" onclick="localToggle(); return false;" href="#">Quick Reference</a>
                </li>
            </ul>
        </div>
        <div id="header">
            <div class="images clearfix">
                
                
            </div>
            <p>The Facebook SDK Plugin allows your Grails application to use the Facebook Platform and develop Facebook apps on Facebook.com or on web sites (with Facebook Connect).
It is a port of the official Facebook PHP SDK V3.1.1 to Grails 2.0.
</p>
        </div>


        <table id="colset" border="0" cellpadding="0" cellspacing="0">
            <tr>
                <td id="col1">
                    <div id="main" class="corner-all">

                        <span id='toggle-col1' class="toggle">(<a href="#" onclick="localToggle(); return false;">Quick Reference</a>)</span>

                        <div class="project">
                            <h1>Facebook SDK Plugin - Reference Documentation</h1>
                            <p><strong>Authors:</strong> Benoit Hediard</p>
                            <p><strong>Version:</strong> 0.6.4</p>
                            
                        </div>

                        
                        <div id="table-of-content">
                            <h2>Table of Contents</h2>
                            
                            <div class="toc-item" style="margin-left:0px"><a href="#introduction"><strong>1</strong><span>Introduction</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0px"><a href="#configuration"><strong>2</strong><span>Configuration</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0px"><a href="#facebookContext"><strong>3</strong><span>Facebook Context</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0px"><a href="#facebookGraphClient"><strong>4</strong><span>Facebook Graph Client</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0px"><a href="#facebookJSTagLib"><strong>5</strong><span>Facebook JS Tag Lib</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0px"><a href="#facebookSocialPlugins"><strong>6</strong><span>Facebook Social Plugins</span></a></div>
                            
                            <div style="clear:both" ></div>
                        </div>
                        
                        

<h1 id="introduction">1 Introduction</h1>
The <a href="http://developers.facebook.com/" target="blank">Facebook Platform</a> is a set of APIs that make your application more social. Read more about <a href="http://developers.facebook.com/docs/guides/web" target="blank">integrating Facebook with your web site</a> on the Facebook developer site.<p class="paragraph"/>This project contains the open source <strong class="bold">Grails Facebook SDK Plugin</strong> that allows you to integrate the <a href="http://developers.facebook.com/" target="blank">Facebook Platform</a> on a website/app powered by <a href="http://grails.org" target="blank">Grails</a> .<p class="paragraph"/>This plugin is a port of the official <a href="http://github.com/facebook/facebook-php-sdk" target="blank">Facebook PHP SDK V3.1.1</a> to <a href="http://grails.org" target="blank">Grails 2.0</a> .<p class="paragraph"/>It supports the latest <strong class="bold">OAuth2.0 authentication</strong> (required since October 1st 2011).<p class="paragraph"/><strong class="bold">Grails Facebook SDK Plugin</strong> provides the following Grails artefacts:
<ul class="star">
<li><code>FacebookContext</code> - A Spring bean to get current Facebook context in controllers, when running <a href="http://developers.facebook.com/docs/guides/canvas/" target="blank">apps on Facebook.com</a> and <a href="http://developers.facebook.com/docs/guides/web" target="blank">websites with the Facebook Platform</a> .</li>
<li><code>FacebookGraphClient</code> - A client to call <a href="http://developers.facebook.com/docs/reference/api/," target="blank">Facebook Graph API</a> which is a wrapper around the rock solid <a href="http://restfb.com/" target="blank">RestFB java library</a> version 1.6.10 (released September 03, 2012).</li>
<li><code>FacebookJSTagLib</code> - A collection of tags to easily integrate <a href="http://developers.facebook.com/docs/reference/javascript/" target="blank">Facebook JS SDK</a> in your GSPs.</li>
</ul><p class="paragraph"/><h3>Latest releases</h3><p class="paragraph"/><blockquote class="warning">
WARNING: Since V0.4.0, <code>FacebookApp</code>, <code>FacebookSdkFilters</code> and <code>FacebookAppService</code> from V0.3.* are DEPRECATED and have been replaced by <code>FacebookContext</code>: a cleaner approach to access Facebook context related info.<p class="paragraph"/>Please check <a href="../guide/single.html#facebookContext" class="guide"><code>FacebookContext</code></a> doc for more info.
</blockquote>
<ul class="star">
<li>2014-05-23 <strong class="bold">V0.6.4</strong> : <code>version</code> attribute added to initJS tag to choose API version for Facebook JS SDK (v1.0 or v2.0)</li>
<li>2014-05-19 <strong class="bold">V0.6.3</strong> : customSelector attribute and config param added to tag lib</li>
<li>2014-04-28 <strong class="bold">V0.6.2</strong> : bug fix in FacebookContext (use @PostConstruct instead of InitializingBean) to solve reloading issue since Grails 2.3.7 (GRAILS-7799)</li>
<li>2014-04-04 <strong class="bold">V0.6.1</strong> : TagLib update (scripts are only included once in a page even if tags are used more than once)</li>
<li>2014-04-02 <strong class="bold">V0.6.0</strong> : Resources Grails Plugin dependencies removed (to be compatible with Asset Pipeline Grails Plugin)</li>
<li>2014-02-12 <strong class="bold">V0.5.0</strong> : RestFB dependency updated to 1.6.14</li>
<li>2013-12-06 <strong class="bold">V0.4.13</strong> : bug fix in picture tag (secure mode)</li>
<li>2013-06-05 <strong class="bold">V0.4.12</strong> : bug fix in sendLink tag (callback attribute)</li>
<li>2013-05-28 <strong class="bold">V0.4.11</strong> : <code>tokenRetrievalRetryCount</code> config parameter added + doc update</li>
<li>2013-04-03 <strong class="bold">V0.4.10</strong> : RestFB dependency updated to 1.6.12 + bug fix token exchange</li>
<li>2013-03-19 <strong class="bold">V0.4.9</strong> : bug fix token exchange from code with concurrent requests (thanks to <a href="https://github.com/elegorod" target="blank">elegorod</a> )</li>
<li>2013-01-03 <strong class="bold">V0.4.8</strong> : bug fix token expiration time handling (in Facebook Page tabs)</li>
<li>2012-12-20 <strong class="bold">V0.4.7</strong> : bug fix resources definition</li>
<li>2012-12-07 <strong class="bold">V0.4.6</strong> : bug fix in invite/publish/send tags (encode text as HTML in attributes)</li>
<li>2012-12-05 <strong class="bold">V0.4.5</strong> : bug fix in <code>FacebookSignedRequest</code> appData property</li>
<li>2012-11-15 <strong class="bold">V0.4.4</strong> : for photo/video publishing, <code>FacebookGraphClient</code> <code>publish</code> method accepts now <code>InputStream</code> argument type (instead of <code>FileInputStream</code> only)</li>
<li>2012-10-29 <strong class="bold">V0.4.3</strong> : tag lib improvements: channel integration (<code>initJS</code> tag and <code>FacebookSdkController</code> created), resources plugin integration (<code>FacebookSdkResources</code> created)</li>
<li>2012-10-10 <strong class="bold">V0.4.2</strong> : bug fix in batch responses error handling</li>
<li>2012-09-25 <strong class="bold">V0.4.1</strong> : bug fix in server side OAuth redirect</li>
<li>2012-10-25 <strong class="bold">V0.4.0</strong> : complete refactoring to improve SDK architecture (<a href="../guide/single.html#facebookContext" class="guide"><code>FacebookContext</code></a> implemented) and <a href="../guide/single.html#configuration" class="guide">multiple Facebook apps</a> support added</li>
<li>2012-09-03 <strong class="bold">V0.3.6</strong> : RestFB dependency updated to 1.6.10, <code>proxyHost</code> and <code>proxyPort</code> added to config and <code>signedRequest</code> added to filter <code>facebook</code> map</li>
<li>2012-08-24 <strong class="bold">V0.3.5</strong> : <code>proxyHost</code> and <code>proxyPort</code> parameters added to Graph/Rest client (thanks to Eduard Martini)</li>
<li>2012-07-23 <strong class="bold">V0.3.4</strong> : bug fix in <code>facebookAppService</code></li>
<li>2012-07-17 <strong class="bold">V0.3.3</strong> : <code>readTimeout</code> parameter added to Graph/Rest client + upgrade to Grails 2.1 with wrapper</li>
<li>2012-06-12 <strong class="bold">V0.3.2</strong> : bug fix in filter and plugin config</li>
<li>2012-06-12 <strong class="bold">V0.3.1</strong> : package <code>grails.plugins.facebooksdk</code> renamed to <code>grails.plugin.facebooksdk</code></li>
<li>2012-06-08 <strong class="bold">V0.3.0</strong> : new documentation based on GDoc, <code>FacebookRestClient</code> added + bug fixes</li>
</ul><p class="paragraph"/><h3>Bugs</h3><p class="paragraph"/>To report any bug, please use the project <a href="http://github.com/agorapulse/grails-facebook-sdk/issues" target="blank">Issues</a> section on GitHub.<p class="paragraph"/><h3>Demo app</h3><p class="paragraph"/>If you want to quickly run the SDK on a demo app, you can download <a href="https://github.com/agorapulse/grails-facebook-sdk-demo" target="blank">Facebook SDK Grails - Demo</a> .<p class="paragraph"/>
<h3>Integration with Shiro Grails Plugin</h3><p class="paragraph"/>To see an example of integration with Shiro Grails Plugin, you can download <a href="https://github.com/agorapulse/grails-facebook-sdk-demo-shiro" target="blank">Facebook SDK Grails - Shiro demo</a> .<p class="paragraph"/>
<h3>About</h3><p class="paragraph"/>The <strong class="bold">Grails Facebook SDK Plugin</strong> is not an official Facebook SDK such as <a href="http://developers.facebook.com/docs/reference/javascript/" target="blank">Javascript</a> , <a href="http://github.com/facebook/facebook-php-sdk" target="blank">PHP</a> , <a href="http://github.com/facebook/facebook-ios-sdk/" target="blank">iOS</a> and <a href="http://github.com/facebook/facebook-android-sdk" target="blank">Android SDKs</a> .<p class="paragraph"/>It is developed by <a href="http://www.agorapulse.com" target="blank">AgoraPulse</a> and licensed under the <a href="http://www.apache.org/licenses/LICENSE-2.0.html" target="blank">Apache Licence, Version 2.0</a> .



<h1 id="configuration">2 Configuration</h1>
<h3>Installation</h3><p class="paragraph"/>Declare the plugin dependency in <code>BuildConfig.groovy</code> file, as shown here:<p class="paragraph"/><div class="code"><pre>grails.project.dependency.resolution = &#123;
		inherits(<span class="java&#45;quote">"global"</span>) &#123; &#125;
		log <span class="java&#45;quote">"info"</span>
		repositories &#123;
				//your repositories
		&#125;
		dependencies &#123;
				//your regular dependencies
		&#125;
		plugins &#123;
				//here go your plugin dependencies
				runtime ':facebook&#45;sdk:0.6.4'
		&#125;
&#125;</pre></div><p class="paragraph"/>
<h3>Single Facebook app</h3><p class="paragraph"/>Create a Facebook app on <a href="https://developers.facebook.com/apps" target="blank">Facebook Developers</a> , in order to get your own app ID and app secret.<p class="paragraph"/>Add your app settings in <code>Config.groovy</code>:<p class="paragraph"/><div class="code"><pre>// Required
grails.plugin.facebooksdk.app.id = &#123;APP_ID&#125;
grails.plugin.facebooksdk.app.permissions = &#123;APP_PERMISSIONS&#125; // Ex. &#91;'email','user_photos'&#93;
grails.plugin.facebooksdk.app.secret = &#123;APP_SECRET&#125;
// Optional, <span class="java&#45;keyword">default</span> proxy config <span class="java&#45;keyword">for</span> Facebook Graph Client API calls
// grails.plugin.facebooksdk.proxyHost = &#123;PROXY_HOST&#125;
// grails.plugin.facebooksdk.proxyPort = &#123;PROXY_PORT&#125;</pre></div><p class="paragraph"/>Or<p class="paragraph"/><div class="code"><pre>grails &#123;
    plugin &#123;
        facebooksdk &#123;
            app = &#91;
                id: APP_ID,
                permissions: APP_PERMISSIONS,
                secret: APP_SECRET
            &#93;
        &#125;
    &#125;
&#125;</pre></div><p class="paragraph"/>
<h3>Multiple Facebook apps</h3><p class="paragraph"/>Since V0.4, it is possible do define multiple apps in <code>Config.groovy</code>:<p class="paragraph"/><div class="code"><pre>grails &#123;
    plugin &#123;
        facebooksdk &#123;
            appIdParamName = 'app_id' // Default app selection param name
            apps = &#91;
                &#91;
                    id: &#123;APP_ID1&#125;,
                    permissions: &#123;APP_PERMISSIONS1&#125;, // Ex. &#91;'email','user_photos'&#93;
                    secret: &#123;APP_SECRET1&#125;
                &#93;,
                &#91;
                    id: &#123;APP_ID2&#125;,
                    permissions: &#123;APP_PERMISSIONS2&#125;, // Ex. &#91;'email','user_photos'&#93;
                    secret: &#123;APP_SECRET2&#125;
                &#93;,
                &#8230;
            &#93;
        &#125;
    &#125;
&#125;</pre></div><p class="paragraph"/>
For each request, you must define <code>app_id</code> in <code>params</code> (by appending <code>?app_id={APP_ID}</code> to query string) in order to specify which Facebook app setting to use.<p class="paragraph"/>Note: to define another parameter name, set config param <code>grails.plugin.facebooksdk.appIdParamName</code>.<p class="paragraph"/>You can also associate a Facebook app to a default controller by adding controller name in each app settings :<p class="paragraph"/><div class="code"><pre>grails &#123;
    plugin &#123;
        facebooksdk &#123;
            apps = &#91;
                &#91;
                    controller: &#123;CONTROLLER_NAME1&#125;,
                    id: &#123;APP_ID1&#125;,
                    permissions: &#123;APP_PERMISSIONS1&#125;,
                    secret: &#123;APP_SECRET1&#125;
                &#93;,
                &#91;
                    controller: &#123;CONTROLLER_NAME2&#125;,
                    id: &#123;APP_ID2&#125;,
                    permissions: &#123;APP_PERMISSIONS2&#125;,
                    secret: &#123;APP_SECRET2&#125;
                &#93;,
                &#8230;
            &#93;
        &#125;
    &#125;
&#125;</pre></div><p class="paragraph"/>For example, let's say you have two apps with two controllers: <code>QuizController</code> and <code>SweepstakesController</code>.<p class="paragraph"/>Add <code>controller: 'quiz'</code> in quiz app settings and <code>controller: 'sweepstakes'</code> in sweepstakes app settings.<p class="paragraph"/>To access your quiz app, use http://localhost:8080/my-app/<strong class="bold">quiz</strong> .<p class="paragraph"/>To access your sweepstakes app, use http://localhost:8080/my-app/<strong class="bold">sweepstakes</strong> .<p class="paragraph"/>If no app is found based on <code>app_id</code> params and controller name, default single app <code>grails.plugin.facebooksdk.app</code> settings will be used (if defined).<p class="paragraph"/>
<h3>Session replication and authorization code</h3><p class="paragraph"/>When using distributed session replication, if authorization code is used by two concurrent processes, one of the process will received an error from Facebook and the session will be invalidated.
You can add the <code>tokenRetrievalRetryCount</code> config parameter to try to extract token from session several times before invalidating the session (the time for the first process to put the token received by Facebook into session scope).<p class="paragraph"/><div class="code"><pre>grails.plugin.facebooksdk.tokenRetrievalRetryCount = 10</pre></div><p class="paragraph"/>By default, this parameter is usually not required and is disabled by default.<p class="paragraph"/><h3>Controllers scope</h3><p class="paragraph"/>Since FacebookContext should be instantiated at each request, you must use `prototype` scope for your Controllers (since Grails 2.3, generated Config.groovy defines `singleton` as default scope).<p class="paragraph"/><div class="code"><pre>grails.controllers.defaultScope = 'prototype'</pre></div><p class="paragraph"/><h3>JQuery custom selector</h3><p class="paragraph"/>Default jQuery selector is `$`, if you require another one, you can define it globally in your  <em class="italic">grails-app/conf/Config.groovy</em> :<p class="paragraph"/><div class="code"><pre>grails.plugin.facebooksdk.customSelector = 'jQuery'</pre></div>


<h1 id="facebookContext">3 Facebook Context</h1>
<blockquote class="warning">
WARNING: Since V0.4.0, <code>FacebookApp</code>, <code>FacebookSdkFilters</code> and <code>FacebookAppService</code> from V0.3.<strong class="bold"> have been deprecated and replaced by <code>FacebookContext</code>: a cleaner approach to access Facebook context related info.<p class="paragraph"/>Sorry, V0.3.</strong> users, you might have to do some refactoring&#8230;
</blockquote><p class="paragraph"/>The plugin can automatically create a <code>facebookContext</code> Spring bean, with all the required info:
<ul class="minus">
<li><strong class="bold">current Facebook signed request</strong> (if defined).</li>
<li><strong class="bold">current Facebook app</strong>,</li>
<li><strong class="bold">current Facebook user</strong> (if authenticated),</li>
<li><strong class="bold">current Facebook page</strong> (if running in a facebook page tab),</li>
</ul><p class="paragraph"/>To automatically inject it in your controllers, add the <code>facebookContext</code> property.<p class="paragraph"/><div class="code"><pre>MyController &#123;<p class="paragraph"/>    FacebookContext facebookContext
    &#8230;
    def index() &#123;
        <span class="java&#45;object">long</span> userId = facebookContext.user.id
        &#8230;
    &#125;
&#125;</pre></div><p class="paragraph"/>Note: <code>facebookContext</code> is a <code>request</code> scope bean and should only be used in Grails controllers (or other <code>request</code> scope beans).<p class="paragraph"/>If you want to access <code>facebookContext</code> from a non <code>request</code> scope bean (ex.: <code>singleton</code> filters), you should use <code>facebookContextProxy</code> (AOP scoped proxy).<p class="paragraph"/><div class="code"><pre>MyFilter &#123;<p class="paragraph"/>    FacebookContext facebookContextProxy
    &#8230;
    def index() &#123;
        <span class="java&#45;object">long</span> userId = facebookContextProxy.user.id
        &#8230;
    &#125;
&#125;</pre></div><p class="paragraph"/>
<h3>Signed Request</h3><p class="paragraph"/>The context gives you access to the current signed request sent to your app by Facebook :
<ul class="minus">
<li>on <strong class="bold">apps.facebook.com</strong> or in a <strong class="bold">page tab</strong>, through <code>signed_request</code> params posted to the app iframe,</li>
<li>on <strong class="bold">external sites</strong> (web or mobile) through <a href="http://developers.facebook.com/docs/reference/javascript/" target="blank">Facebook JS SDK</a> signed request cookie.</li>
</ul><p class="paragraph"/><div class="code"><pre>// To get access to signed request data
facebookContext.signedRequest</pre></div><p class="paragraph"/>But the signed request is automatically parsed and all its data are available in <code>FacebookContext</code>, so you should not have to use it.<p class="paragraph"/><blockquote class="note">
If you are running your app on <strong class="bold">apps.facebook.com</strong> or in a <strong class="bold">page tab</strong>, <code>signedRequest</code> is only available on initial request (if you navigate inside the iframe, signed request is lost if you do not pass it to your links params).
</blockquote><p class="paragraph"/>
<h3>Facebook App</h3><p class="paragraph"/>The context gives you access to <strong class="bold">current Facebook app</strong> info.<p class="paragraph"/><div class="code"><pre>// To get Facebook app id (defined in Config.groovy)
facebookContext.app.id
// To get Facebook app permissions (defined in Config.groovy)
facebookContext.app.permissions
 // To get Facebook app secret (defined in Config.groovy)
facebookContext.app.secret
 // To get <span class="java&#45;keyword">default</span> app token, concatenation of id and secret
facebookContext.app.token
// To get OAuth app token, required <span class="java&#45;keyword">for</span> Graph API calls (it will generate a Graph API call)
facebookContext.app.getToken(<span class="java&#45;keyword">true</span>)</pre></div><p class="paragraph"/>If you are running your app in a <strong class="bold">page tab</strong>, you'll get additional info:<p class="paragraph"/><div class="code"><pre>// To get app data pass through page tab query string (...&#38;app_data=&#123;SOME_STRING&#125;...)
facebookContext.app.data</pre></div><p class="paragraph"/>
<h3>Facebook User</h3><p class="paragraph"/>To check if current user has authorized your app and is authenticated, use <code>facebookContext.authenticated</code>.<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">if</span> (facebookContext.authenticated) &#123;
    // User is authenticated
&#125;</pre></div><p class="paragraph"/>If authenticated, the context gives you access to <strong class="bold">current Facebook user</strong> info.<p class="paragraph"/><div class="code"><pre>// To get facebook user id
facebookContext.user.id
// To get OAuth user token, required <span class="java&#45;keyword">for</span> Graph API calls
facebookContext.user.token</pre></div><p class="paragraph"/>If the app is running on an <strong class="bold">external site</strong> (web or mobile), the access token will be automatically fetched in exchange for the authorization code returned by <a href="http://developers.facebook.com/docs/reference/javascript/" target="blank">Facebook JS SDK</a> signed request cookie or server-side redirect query string.<p class="paragraph"/>If the app is running on <strong class="bold">apps.facebook.com</strong> or in a <strong class="bold">page tab</strong>, the access token will be extracted from the signed request params (passed through the canvas iFrame) and you'll get additional info:<p class="paragraph"/><div class="code"><pre>// To get facebook user age restriction (only returned in Canvas apps, it will not be returned <span class="java&#45;keyword">for</span> external apps)
facebookContext.user.age
// To get facebook user country
facebookContext.user.country
 // To get facebook user locale
facebookContext.user.locale</pre></div><p class="paragraph"/>In order to optimize performances, user <code>id</code> and <code>token</code> are automatically stored in <code>session</code> scope.<p class="paragraph"/>By default <code>token</code> are only valid during 2 hours, if a request is made with an expired token, session will be automatically invalidated.
If required, you can exchange the short-term token for a long-lived one (valid during 60 days).<p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">if</span> (facebookContext.authenticated &#38;&#38; !facebookContext.user.tokenExpired) &#123;
  // Exchange token to get an extended expiration time (60 days)
  log.info <span class="java&#45;quote">"Current token expiration time: "</span> + <span class="java&#45;keyword">new</span> Date(facebookContext.user.tokenExpirationTime)
  facebookContext.user.exchangeToken()
  log.info <span class="java&#45;quote">"Exchanged token expiration time:  "</span> + <span class="java&#45;keyword">new</span> Date(facebookContext.user.tokenExpirationTime)
&#125;</pre></div><p class="paragraph"/><h3>Facebook Page</h3><p class="paragraph"/>If the app is running in a <strong class="bold">page tab</strong>, the context gives you access to <strong class="bold">current Facebook page</strong> info.<p class="paragraph"/>Otherwise, <code>facebookContext.page</code> is <code>null</code>. You must check if it exists before accessing it.<p class="paragraph"/><div class="code"><pre>// To get facebook page id (where the app is installed)
facebookContext.page?.id
// To know <span class="java&#45;keyword">if</span> current user has liked the current page
facebookContext.page?.liked
 // To know <span class="java&#45;keyword">if</span> current user is an admin of the current page
facebookContext.page?.admin</pre></div>


<h1 id="facebookGraphClient">4 Facebook Graph Client</h1>
To perform Facebook Graph API call, use the <code>FacebookGraphClient</code> without access token for public data or with an access token for private data.
<code>FacebookGraphClient</code> is a thin groovy wrapper around the rock solid <a href="http://restfb.com/" target="blank">RestFB java library</a> .
It will return JSON-based graph objects.<p class="paragraph"/>To play with the API, you might use the grails console from your project root and get user token or app token from <a href="https://developers.facebook.com/tools/access_token/" target="blank">Facebook Access Token Tool</a> .<p class="paragraph"/><div class="code"><pre>grails console</pre></div><p class="paragraph"/><h3>Initialization</h3><p class="paragraph"/><div class="code"><pre><span class="java&#45;keyword">import</span> grails.plugin.facebooksdk.FacebookGraphClient<p class="paragraph"/>// For <span class="java&#45;keyword">public</span> data
def facebookClient = <span class="java&#45;keyword">new</span> FacebookGraphClient()<p class="paragraph"/>// For <span class="java&#45;keyword">private</span> data (access token required)
def userAccessToken = facebookAppService.getUserAccessToken() // Or any app/user token
def facebookClient = <span class="java&#45;keyword">new</span> FacebookGraphClient(userAccessToken)<p class="paragraph"/>// With specific timeout (<span class="java&#45;keyword">default</span> to 180s)
def facebookClient = <span class="java&#45;keyword">new</span> FacebookGraphClient(userAccessToken, 90000)<p class="paragraph"/>// With proxy support
def facebookClient = <span class="java&#45;keyword">new</span> FacebookGraphClient(userAccessToken, FacebookGraphClient.DEFAULT_READ_TIMEOUT_IN_MS, '192.168.0.10', 8080)</pre></div><p class="paragraph"/><h3>Fetching Single Objects</h3><p class="paragraph"/><div class="code"><pre>def user = facebookClient.fetchObject(<span class="java&#45;quote">"me"</span>) // Requires a user access token
def page = facebookClient.fetchObject(<span class="java&#45;quote">"cocacola"</span>)
println <span class="java&#45;quote">"User name: "</span> + user.name
println <span class="java&#45;quote">"Page likes: "</span> + page.likes</pre></div><p class="paragraph"/><h3>Fetching Multiple Objects in One Call</h3><p class="paragraph"/><div class="code"><pre>def fetchObjectsResults = facebookClient.fetchObjects(&#91;<span class="java&#45;quote">"me"</span>, <span class="java&#45;quote">"cocacola"</span>&#93;)
println <span class="java&#45;quote">"User name: "</span> + fetchObjectsResults&#91;<span class="java&#45;quote">"me"</span>&#93;.name
println <span class="java&#45;quote">"Page likes: "</span> + fetchObjectsResults&#91;<span class="java&#45;quote">"cocacola"</span>&#93;.likes</pre></div><p class="paragraph"/><h3>Fetching Connections</h3><p class="paragraph"/>Make sure that you asked for the corresponding user permissions, e.g. <code>user_status</code> for the feed, <code>user_photos</code> for the photos, etc.<p class="paragraph"/><div class="code"><pre>def myFriends = facebookClient.fetchConnection(<span class="java&#45;quote">"me/friends"</span>)
def myFeed = facebookClient.fetchConnection(<span class="java&#45;quote">"me/feed"</span>)
println <span class="java&#45;quote">"Count of my friends: "</span> + myFriends.size()
println <span class="java&#45;quote">"First item in my feed: "</span> + myFeed&#91;0&#93;</pre></div><p class="paragraph"/><h3>Searching</h3><p class="paragraph"/><div class="code"><pre>// Searching is just a special <span class="java&#45;keyword">case</span> of fetching Connections &#45;
// all you have to <span class="java&#45;keyword">do</span> is pass along a few extra parameters.
def publicSearch = facebookClient.fetchConnection(<span class="java&#45;quote">"search"</span>, &#91;q:<span class="java&#45;quote">"watermelon"</span>, type:<span class="java&#45;quote">"post"</span>&#93;)
println <span class="java&#45;quote">"Public search: "</span> + publicSearch&#91;0&#93;.message
// Targeted search
def targetedSearch = facebookClient.fetchConnection(<span class="java&#45;quote">"me/home"</span>, &#91;q:<span class="java&#45;quote">"Mark"</span>, type:<span class="java&#45;quote">"user"</span>&#93;)
println <span class="java&#45;quote">"Posts on my wall by friends named Mark: "</span> + targetedSearch.size()</pre></div><p class="paragraph"/><h3>Fetching Insights</h3><p class="paragraph"/><div class="code"><pre>// Fetching Insights data is as simple as fetching a Connection
def insights = facebookClient.fetchConnection(<span class="java&#45;quote">"PAGE_ID/insights"</span>)
<span class="java&#45;keyword">for</span> (insight in insights) println insight.name</pre></div><p class="paragraph"/><h3>Executing FQL Queries</h3><p class="paragraph"/><div class="code"><pre><span class="java&#45;object">String</span> query = <span class="java&#45;quote">"SELECT uid, name FROM user WHERE uid=220439 or uid=7901103"</span>
def users = facebookClient.executeQuery(query)
println <span class="java&#45;quote">"Users: "</span> + users</pre></div><p class="paragraph"/><h3>Executing Multiple FQL Queries in One Call</h3><p class="paragraph"/><div class="code"><pre>Map queries = &#91;users:<span class="java&#45;quote">"SELECT uid, name FROM user WHERE uid=220439 OR uid=7901103"</span>, likers:<span class="java&#45;quote">"SELECT user_id FROM like WHERE object_id=122788341354"</span>&#93;
multiqueryResults = facebookClient.executeMultiquery(queries)
println <span class="java&#45;quote">"Users: "</span> + multiqueryResults.users
println <span class="java&#45;quote">"People who liked: "</span> + multiqueryResults.likers</pre></div><p class="paragraph"/><h3>Metadata/Introspection</h3><p class="paragraph"/><div class="code"><pre>// You can specify metadata=1 <span class="java&#45;keyword">for</span> many calls, not just <span class="java&#45;keyword">this</span> one.
// See the Facebook Graph API documentation <span class="java&#45;keyword">for</span> more details.
def userWithMetadata = facebookClient.fetchObject(<span class="java&#45;quote">"me"</span>, &#91;metadata:1&#93;)
println <span class="java&#45;quote">"User connections  "</span> + userWithMetadata.metadata.connections</pre></div><p class="paragraph"/><h3>Passing Parameters</h3><p class="paragraph"/><div class="code"><pre>// You can pass along any parameters you'd like to the Facebook endpoint.
Date oneWeekAgo = <span class="java&#45;keyword">new</span> Date() &#45; 7
def filteredFeed = facebookClient.fetchConnection(<span class="java&#45;quote">"me/feed"</span>, &#91;limit:3, until:<span class="java&#45;quote">"yesterday"</span>, since:oneWeekAgo&#93;)
println <span class="java&#45;quote">"Filtered feed count: "</span> + filteredFeed.size()</pre></div><p class="paragraph"/><h3>Selecting Specific Fields</h3><p class="paragraph"/><div class="code"><pre>def user = facebookClient.fetchObject(<span class="java&#45;quote">"me"</span>, &#91;fields:<span class="java&#45;quote">"id, name"</span>&#93;)
println <span class="java&#45;quote">"User name: "</span> + user.name</pre></div><p class="paragraph"/><h3>Publishing a Message and Event</h3><p class="paragraph"/><div class="code"><pre>// Publishing a simple message.
def publishMessageResponse = facebookClient.publish(<span class="java&#45;quote">"me/feed"</span>, &#91;message:<span class="java&#45;quote">"RestFB test"</span>&#93;)
println <span class="java&#45;quote">"Published message ID: "</span> + publishMessageResponse.id<p class="paragraph"/>// Publishing an event
Date tomorrow = <span class="java&#45;keyword">new</span> Date() + 1
Date twoDaysFromNow = <span class="java&#45;keyword">new</span> Date() + 2
def publishEventResponse = facebookClient.publish(<span class="java&#45;quote">"me/events"</span>, &#91;name:<span class="java&#45;quote">"Party"</span>, start_time:tomorrow, end_time:twoDaysFromNow&#93;)
println <span class="java&#45;quote">"Published event ID: "</span> + publishEventResponse.id</pre></div><p class="paragraph"/><h3>Publishing a Photo or a Video</h3><p class="paragraph"/><div class="code"><pre>// Publishing an image to a photo album is easy!
// Just specify the image you'd like to upload and RestFB will handle it from there.
def publishPhotoResponse = facebookClient.publish(<span class="java&#45;quote">"me/photos"</span>, &#91;message, <span class="java&#45;quote">"Test cat"</span>&#93;, <span class="java&#45;quote">"/Users/ben/Downloads/cat.png"</span>)
println <span class="java&#45;quote">"Published photo ID: "</span> + publishPhotoResponse.id
// Publish a submitted file
def publishPhotoResponse = facebookClient.publish(<span class="java&#45;quote">"me/photos"</span>, &#91;message, <span class="java&#45;quote">"Test upload"</span>&#93;, multipartFile.originalFilename, multipartFile.inputStream)
// Publish an existing remote file by URL
def someUrl = <span class="java&#45;quote">"http://www.google.com/images/logo.gif"</span>
def publishPhotoResponse = facebookClient.publish(<span class="java&#45;quote">"me/photos"</span>, &#91;message, <span class="java&#45;quote">"Test logo"</span>&#93;, <span class="java&#45;quote">"logo.gif"</span>, <span class="java&#45;keyword">new</span> URL(someUrl).openStream())
println <span class="java&#45;quote">"Published photo ID: "</span> + publishPhotoResponse.id
// Publishing a video works the same way.
facebookClient.publish(<span class="java&#45;quote">"me/videos"</span>, &#91;message, <span class="java&#45;quote">"Test cat"</span>&#93;, <span class="java&#45;quote">"/Users/ben/Downloads/cat.mov"</span>)</pre></div><p class="paragraph"/><h3>Deleting</h3><p class="paragraph"/><div class="code"><pre><span class="java&#45;object">Boolean</span> deleted = facebookClient.deleteObject(<span class="java&#45;quote">"some object ID"</span>)
out.println(<span class="java&#45;quote">"Deleted object? "</span> + deleted)</pre></div><p class="paragraph"/><h3>Using the Batch Request API</h3><p class="paragraph"/><div class="code"><pre>List batchResponses = facebookClient.executeBatch(&#91;<span class="java&#45;quote">"me"</span>, <span class="java&#45;quote">"m83music/feed"</span>&#93;);
// Responses are ordered to match up with their corresponding requests.
println <span class="java&#45;quote">"Me object "</span> + batchResponses&#91;0&#93;
println <span class="java&#45;quote">"M83 feed "</span> + batchResponses&#91;1&#93;</pre></div><p class="paragraph"/><h3>Error Handling</h3><p class="paragraph"/>All <code>FacebookClient</code> methods may throw <code>com.restfb.exception.FacebookException</code>, which is an unchecked exception as of RestFB 1.6.<p class="paragraph"/>These are the <code>FacebookException</code> subclasses that you may catch:
<ul class="star">
<li><code>FacebookJsonMappingException</code></li>
<li><code>FacebookNetworkException</code></li>
<li><code>FacebookGraphException</code></li>
<li><code>FacebookOAuthException</code></li>
<li><code>FacebookQueryParseException</code></li>
<li><code>FacebookResponseStatusException</code></li>
</ul><p class="paragraph"/>For more info, check <a href="http://restfb.com/" target="blank">RestFB java library</a> documentation.


<h1 id="facebookJSTagLib">5 Facebook JS Tag Lib</h1>
<strong class="bold">Facebook JS Tag Lib</strong> is a set of tags to easily integrate <a href="http://developers.facebook.com/docs/reference/javascript/" target="blank">Facebook JS SDK</a> Dialogs in your GSPs.<p class="paragraph"/>It provides the following tags:
<ul class="star">
<li><a href="http://agorapulse.github.io/grails-facebook-sdk/ref/tags/initJS.html" target="blank">initJS</a> - Initialize <a href="http://developers.facebook.com/docs/reference/javascript/" target="blank">Facebook JS SDK</a> (REQUIRED to use other tags).</li>
<li><a href="http://agorapulse.github.io/grails-facebook-sdk/ref/tags/addToPageLink.html" target="blank">addToPageLink</a> - Display a link to open <a href="https://developers.facebook.com/docs/reference/dialogs/add_to_page/" target="blank">Add To Page Dialog</a> .</li>
<li><a href="http://agorapulse.github.io/grails-facebook-sdk/ref/tags/inviteLink.html" target="blank">inviteLink</a> - Display a link to open <a href="https://developers.facebook.com/docs/reference/dialogs/requests/" target="blank">Request Dialog</a> .</li>
<li><a href="http://agorapulse.github.io/grails-facebook-sdk/ref/tags/loginLink.html" target="blank">loginLink</a> - Display a link to prompt the user to authorize your application, or grant it permissions.</li>
<li><a href="http://agorapulse.github.io/grails-facebook-sdk/ref/tags/logoutLink.html" target="blank">logoutLink</a> - Display a link to invalidate current user session.</li>
<li><a href="http://agorapulse.github.io/grails-facebook-sdk/ref/tags/picture.html" target="blank">picture</a> - Display user profile picture with a specific size.</li>
<li><a href="http://agorapulse.github.io/grails-facebook-sdk/ref/tags/publishLink.html" target="blank">publishLink</a> - Display a link to open <a href="https://developers.facebook.com/docs/reference/dialogs/feed/" target="blank">Feed Dialog</a> .</li>
<li><a href="http://agorapulse.github.io/grails-facebook-sdk/ref/tags/sendLink.html" target="blank">sendLink</a> - Display a link to open <a href="https://developers.facebook.com/docs/reference/dialogs/send/" target="blank">Send Dialog</a> .</li>
</ul><p class="paragraph"/>Dialogs not yet implemented:
<ul class="star">
<li><a href="https://developers.facebook.com/docs/reference/dialogs/friends/" target="blank">Friends Dialog</a> .</li>
<li><a href="https://developers.facebook.com/docs/reference/dialogs/pay/" target="blank">Pay Dialog</a> .</li>
</ul><p class="paragraph"/>Feel free to contribute&#8230; ;)


<h1 id="facebookSocialPlugins">6 Facebook Social Plugins</h1>
<h3>Facebook Social Plugins</h3><p class="paragraph"/>Facebook also provides <a href="http://developers.facebook.com/docs/plugins/" target="blank">Facebook Social Plugins</a> .<p class="paragraph"/>They are very easy to integrate, you just need to set <code>xfbml</code> to <code>true</code> in <code>facebook:initJS</code> tag.<p class="paragraph"/><div class="code"><pre>&#8230;
&#60;body&#62;
&#60;facebook:initJS
        appId=<span class="java&#45;quote">"$&#123;facebookContext.app.id&#125;"</span>
        xfbml=<span class="java&#45;quote">"$&#123;<span class="java&#45;keyword">true</span>&#125;"</span> /&#62;
&#8230;
&#60;!&#45;&#45; Facebook Like Button &#45;&#45;&#62;
&#60;div class=<span class="java&#45;quote">"fb&#45;like"</span> data&#45;href=<span class="java&#45;quote">"http://example.com"</span> data&#45;send=<span class="java&#45;quote">"<span class="java&#45;keyword">false</span>"</span> data&#45;show&#45;faces=<span class="java&#45;quote">"<span class="java&#45;keyword">false</span>"</span> data&#45;width=<span class="java&#45;quote">"810"</span>&#62;&#60;/div&#62;
&#8230;
&#60;!&#45;&#45; Facebook Comments &#45;&#45;&#62;
&#60;div class=<span class="java&#45;quote">"fb&#45;comments"</span> data&#45;href=<span class="java&#45;quote">"http://example.com"</span> data&#45;num&#45;posts=<span class="java&#45;quote">"5"</span> data&#45;width=<span class="java&#45;quote">"810"</span>&#62;&#60;/div&#62;</pre></div>

                    </div>
                </td>
                <td id="col2">
            <div class="local clearfix">
                <div class="local-title">
                    <a href="../guide/index.html" target="mainFrame">Quick Reference</a>
                    <span class="toggle">(<a href="#" onclick="localToggle(); return false;">hide</a>)</span>
                </div>
                <div class="menu">
                    
                    <div class="menu-block"><h1 class="menu-title" onclick="toggleRef(this.parentNode.childNodes[1])">Tags</h1><div class="menu-sub">
                        
                        
                        <div class="menu-item"><a href="../ref/Tags/addToPageLink.html">addToPageLink</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Tags/initJS.html">initJS</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Tags/inviteLink.html">inviteLink</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Tags/loginLink.html">loginLink</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Tags/logoutLink.html">logoutLink</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Tags/picture.html">picture</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Tags/publishLink.html">publishLink</a>
                        </div>
                        
                        <div class="menu-item"><a href="../ref/Tags/sendLink.html">sendLink</a>
                        </div>
                        
                        </div>
                    </div>
                    
                </div>
            </div>
        </td>
            </tr>
        </table>

        <div id="footer">
            
            
        </div>



<script type="text/javascript" src="../js/docs.js"></script>

    </body>
</html>
